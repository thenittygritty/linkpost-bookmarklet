/*! TNG Linkpost Bookmarklet - v1.8.1 - 2013-09-16
* https://github.com/thenittygritty/linkpost-bookmarklet
* Copyright (c) 2013 Kahlil Lechelt; Licensed MIT */
!function(a){"use strict";var b="w00t!",c=a[b].config;c.postUrl="URL TO YOUR LINKPOST PLUGIN PAGE";var d=a[b]={version:"1.8.1",config:c,init:function(){console.log("w00t! This shit is loaded and working!"),d.appendForm();var a=document.getElementById("inputtitle");a.select()},appendForm:function(){var c,e,f,g,h,i,j,k,l,m,n,o=document.createTextNode("Edit Your Linkpost"),p=document.createTextNode("//"),q=document.createTextNode("Create Linkpost"),r=d.getSelectionHtml(),s=a.location;c=d.getStyledElement("div",{font:'300 14px/18px "Helvetica Neue", "Helvetica", sans-serif',"box-sizing":"boder-box",position:"fixed","background-color":"#f7f6f3",height:"616px","z-index":99999,padding:"15px","font-weight":"400",width:"100%","max-width":"500px",top:"20px",left:0,right:0,bottom:0,margin:"auto","-webkit-box-shadow":"0 1px 3px rgba(0, 0, 0, 0.5)","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.5)","border-radius":"5px","float":"none"}),e=d.getStyledElement("h1",{display:"block",font:'bold 20px/24px "Helvetica Neue", "Helvetica", sans-serif',color:"#5b88bb",margin:"0 0 15px 0","text-transform":"none","float":"none"}),j=d.getStyledElement("span",{color:"#e02d0d",font:'300 20px/24px "Helvetica Neue", "Helvetica", sans-serif',"font-weight":"bold","padding-right":"10px","float":"none"}),k={font:'300 14px/18px "Helvetica Neue", "Helvetica", sans-serif',"box-sizing":"border-box",padding:"5px",display:"block",width:"500px","margin-bottom":"10px",border:"1px solid #ccc",margin:"0 0 15px 0","border-radius":"2px","float":"none"},l=d.getStyledElement("input",k),m=d.getStyledElement("input",k),n=d.getStyledElement("input",k),f=d.getStyledElement("textarea",{font:'300 14px/18px "Helvetica Neue", "Helvetica", sans-serif',"box-sizing":"border-box",margin:0,display:"block",width:"100%",height:"400px",border:"1px solid #ccc","border-radius":"2px","float":"none"}),g=d.getStyledElement("form"),h=d.getStyledElement("div",{display:"block",height:"28px",position:"relative"}),i=d.getStyledElement("button",{font:'300 14px/18px "Helvetica Neue", "Helvetica", sans-serif',display:"block","margin-top":"15px","background-color":"#e02d0d",color:"white",border:"none","border-radius":"2px",padding:"5px",position:"absolute",right:"0","float":"none"}),i.addEventListener("click",d.createLinkPost),r&&(f.value="> "+r),c.id="linkpostformcontainer",g.id="linkpostform",m.name="title",m.type="text",m.value=document.title,m.placeholder="Title",m.id="inputtitle",l.value=s,l.name="link",l.type="text",l.placeholder="URL",n.name="author",n.type="text",console.log("undefined?",a[b].config),n.value=a[b].config.author,n.placeholder="Author",f.name="text",c.appendChild(g),j.appendChild(p),e.appendChild(j),e.appendChild(o),i.appendChild(q),g.appendChild(e),g.appendChild(m),g.appendChild(l),g.appendChild(n),g.appendChild(f),h.appendChild(i),g.appendChild(h),document.body.insertBefore(c)},getSelectionHtml:function(){var b=a.getSelection(),c=b.toString();return c},getStyledElement:function(a,b){var c=document.createElement(a);if(c.style.cssText="",void 0!==b)for(var d in b)c.style.cssText+=d+":"+b[d]+" !important;";return c},createLinkPost:function(c){var d=function(){function a(){console.log("AJAXSubmit - Success!")}function b(b){var c=new XMLHttpRequest;if(c.submittedData=b,c.onload=a,0===b.technique)c.open("get",b.receiver.replace(/(?:\?.*)?$/,b.segments.length>0?"?"+b.segments.join("&"):""),!0),c.send(null);else if(c.open("post",b.receiver,!0),3===b.technique){var d="---------------------------"+Date.now().toString(16);c.setRequestHeader("Content-Type","multipart/form-data; boundary="+d),c.sendAsBinary("--"+d+"\r\n"+b.segments.join("--"+d+"\r\n")+"--"+d+"--\r\n")}else c.setRequestHeader("Content-Type",b.contentType),c.send(b.segments.join(2===b.technique?"\r\n":"&"))}function c(a){a.status>0||b(a)}function d(a){this.owner.segments[this.segmentIdx]+=a.target.result+"\r\n",this.owner.status--,c(this.owner)}function e(a){return a.replace(/[\s\=\\]/g,"\\$&")}function f(a){var b,f,g,h,i,j="post"===a.method.toLowerCase();this.contentType=j&&a.enctype?a.enctype:"application/x-www-form-urlencoded",this.technique=j?"multipart/form-data"===this.contentType?3:"text/plain"===this.contentType?2:1:0,this.receiver=a.action,this.status=0,this.segments=[];for(var k=2===this.technique?e:escape,l=0;l<a.elements.length;l++)if(g=a.elements[l],g.hasAttribute("name"))if(f="INPUT"===g.nodeName.toUpperCase()?g.getAttribute("type").toUpperCase():"TEXT","FILE"===f&&g.files.length>0)if(3===this.technique)for(b=0;b<g.files.length;b++)i=g.files[b],h=new FileReader,h.segmentIdx=this.segments.length,h.owner=this,h.onload=d,this.segments.push('Content-Disposition: form-data; name="'+g.name+'"; filename="'+i.name+'"\r\nContent-Type: '+i.type+"\r\n\r\n"),this.status++,h.readAsBinaryString(i);else for(b=0;b<g.files.length;this.segments.push(k(g.name)+"="+k(g.files[b++].name)));else("RADIO"!==f&&"CHECKBOX"!==f||g.checked)&&this.segments.push(3===this.technique?'Content-Disposition: form-data; name="'+g.name+'"\r\n\r\n'+g.value+"\r\n":k(g.name)+"="+k(g.value));c(this)}return function(a){a.action&&new f(a)}}(),e=document.getElementById("linkpostform");e.action=a[b].config.postUrl,e.method="get",e.enctype="application/x-www-form-urlencoded",d(e);var f=document.getElementById("linkpostformcontainer"),g=document.getElementById("dimmerdiv");document.body.removeChild(f),document.body.removeChild(g),c.preventDefault()}}}(window);